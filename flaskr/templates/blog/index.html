{% extends 'base.html' %}

{% block stylesheets %}
<link
    rel="stylesheet"
    href="{{ url_for('static', filename='css/blog/index.css') }}"
/>
{% endblock %}

{% block menu %}
{% if g.user %}
    <span><a class="w3-btn w3-theme-dark" href="{{ url_for('blog.create') }}">New</a></span>
{% endif %}
{% endblock %}

{% block header %}
<div class="w3-container w3-mobile">
    <div class="w3-panel w3-theme w3-center">
        <h2>{% block title %}Blog Posts{% endblock %}</h2>
        <i class="fa-solid fa-rotate-left w3-right" onclick="reverseOnClick();"></i>
    </div>
</div>
{% endblock %}

{% block content %}
<div id="posts" class="w3-container blog-container">
    {% for post in posts %}
    <div class="w3-panel w3-border w3-padding-16 w3-mobile">
        <div class="w3-cell-row w3-theme-l3">
            <div class="w3-container w3-cell w3-cell-middle">
                <h1>{{ post['title'] }}</h1>
            </div>
            <p class="w3-container w3-cell w3-cell-middle w3-right-align">
                by {{ post['username'] }} on {{
                post['created'].strftime('%m/%d/%Y') }}
            </p>
            {% if g.user['id'] == post['author_id'] %}
            <div class="w3-container w3-cell w3-cell-middle w3-right-align">
                <a
                    class="w3-btn w3-theme-dark"
                    href="{{ url_for('blog.update', id=post['id']) }}"
                    >Edit</a
                >
            </div>
            {% endif %}
        </div>
        <div class="w3-cell-row w3-mobile">
            <div class="w3-container w3-cell">
                {{ md.markdown(post['body']) | safe}}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script src="https://kit.fontawesome.com/9208356911.js" crossorigin="anonymous"></script>
<script lang="javascript">
    function getBlogPosts() {
        // Select the parent div (the one with class "w3-panel w3-border w3-padding-16 w3-mobile")
        const parentDiv = document.querySelector('div.w3-container.blog-container');

        // Get all direct child div elements
        const childDivs = Array.from(parentDiv.querySelectorAll(':scope > div'));

        return childDivs;
    }

    function reverseBlogPosts(postsArray) {
        // 1. Reverse the array of blog posts
        const reversedPosts = postsArray.reverse();

        // 2. Get the container element where posts are displayed
        const container = document.getElementById('posts');

        // 3. Clear the current content of the container
        container.innerHTML = '';

        // 4. Loop through the reversed array and append each post to the container
        reversedPosts.forEach(post => {
            container.appendChild(post);
      });
    }

    function reverseOnClick() {
        reverseBlogPosts(getBlogPosts());
    }
</script>
{% endblock %}
